<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ì „ì²´ ê°€ë°© ê²°ê³¼</title>
    <link rel="stylesheet" href="/css/5_result.css">
</head>
<body>
<div class="container">
    <h1>ğŸ“¦ ì €ì¥ëœ ëª¨ë“  ê°€ë°©ë“¤</h1>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ -->
    <div id="passwordError" class="error-message" style="display: none;">
        <p></p>
    </div>

    <!-- Luggage ëª©ë¡ í‘œì‹œ -->
    <div class="luggage-list" th:if="${allLuggages != null and !allLuggages.isEmpty()}">
        <div th:each="luggage : ${allLuggages}" class="luggage-item">
            <div class="luggage-info">
                <h3 th:text="${luggage.userName + 'ì˜ ê°€ë°©'}"></h3>
                <small th:text="${#temporals.format(luggage.dateTime, 'yyyy-MM-dd HH:mm')}"></small>
            </div>

            <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í¼ -->
            <div class="password-form">
                <form class="password-verify-form" th:attr="data-luggage-id=${luggage.LID}">
                    <input type="password" name="inputPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required maxlength="4" autocomplete="off">
                    <button type="submit" class="view-btn">ë³´ê¸°</button>
                </form>
            </div>

            <!-- ìƒì„¸ ì •ë³´ í‘œì‹œ ì˜ì—­ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
            <div th:id="'details-' + ${luggage.LID}" class="luggage-details" style="display: none;">
                <div class="data-section">
                    <h3>ğŸ“ ê³ ë¯¼ ë‚´ìš©</h3>
                    <div class="content-box">
                        <p th:text="${luggage.concern}"></p>
                    </div>
                </div>

                <div class="data-section">
                    <h3>ğŸ’¬ ê°€ë°©ì˜ ë‹µë³€</h3>
                    <div class="answer-box">
                        <p th:text="${luggage.answer}"></p>
                    </div>
                </div>

                <div class="data-section">
                    <h3>â° ìƒì„± ì‹œê°„</h3>
                    <p th:text="${#temporals.format(luggage.dateTime, 'yyyyë…„ MMì›” ddì¼ HH:mm:ss')}"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° -->
    <div th:if="${allLuggages == null or allLuggages.isEmpty()}" class="no-data">
        <p>ì €ì¥ëœ ê°€ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <!-- í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
    <div class="actions">
        <a href="/" class="home-btn">í™ˆìœ¼ë¡œ</a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordError = document.getElementById('passwordError');
        const passwordForms = document.querySelectorAll('.password-verify-form');

        passwordForms.forEach(form => {
            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const luggageId = this.dataset.luggageId;
                const passwordInput = this.querySelector('input[name="inputPassword"]');
                const password = passwordInput.value;

                try {
                    const response = await fetch('/verify-password-ajax', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `luggageId=${luggageId}&inputPassword=${password}`
                    });

                    const result = await response.json();

                    if (result.success) {
                        const detailsDiv = document.getElementById('details-' + luggageId);
                        detailsDiv.style.display = 'block';
                        passwordInput.value = '';
                        passwordError.style.display = 'none';
                    } else {
                        passwordError.querySelector('p').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!';
                        passwordError.style.display = 'block';
                        passwordInput.value = '';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    passwordError.querySelector('p').textContent = 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    passwordError.style.display = 'block';
                }
            });
        });
    });
</script>
</body>
</html>